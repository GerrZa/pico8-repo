pico-8 cartridge // http://www.pico-8.com
version 41
__lua__
function _init()
	mode="game"
	p={}
	p.x=64
	p.y=120
	p.s=1
	p.sx=0
	p.sy=0
	p.jdelay=0
	p.coyote=0
	p.jumpp=false
	p.jumpr=false
	p.jumpbtn=false
	
	g_scene=g_scene:new()
end

function _update60()
	if mode=="game" then
		g_scene:update()
	end
end

function _draw()
	palt(0,false)
	palt(11,true)
	if mode=="game" then
		g_scene:draw()
	end
end

g_scene={}

function g_scene:new(o)
	o=setmetatable(o or {},self)
	self.__index=self
	o.mx=0
	o.my=0
	return o
end

function g_scene:update()
	p.jumpp=false
	p.jumpr=false
	if (btn(❎) and not p.jumpbtn) p.jumpp=true
	if (not btn(❎) and p.jumpbtn) p.jumpr=true
	p.jumpbtn=btn(❎)
	local right=btn(➡️)
	local left=btn(⬅️)
	
	p.jdelay-=1
	
	if (p.jumpp) p.jdelay=5
	if flrcol(p) then
		p.coyote=4
	else
		p.coyote-=1
	end
	
	if (p.jumpr) p.sy=max(p.sy,p.sy/2)
	
	p.sy+=0.1
	p.sx*=0.75
	if (p.sy>2) p.sy=0.5
	if (flrcol(p)) p.sy=0
	if (btn(⬅️)) p.sx=-1
	if (btn(➡️)) p.sx=1
	
	
	if p.jdelay>0 and p.coyote>0 then
		p.sy=-2
		p.jdelay=0
		p.coyote=0
		p.x=flr(p.x)
	end
	
	p.x+=p.sx
	p.y+=p.sy
	
	while (inflr(p)) do
		p.y-=0.1
	end 
	
end

function g_scene:draw()
	cls(1)
	map(self.mx,self.my)
	spr(p.s,p.x,p.y)
end
-->8
--tool
function flrcol(a)
	local ax=a.x
	local ay=a.y
	
	if (fget(mget(ax/8,(ay+8)/8),0) or fget(mget((ax+7)/8,(ay+8)/8),0)) return true
	return false	
end

function inflr(a)
	local ax=a.x
	local ay=a.y
	
	if (fget(mget(ax/8,(ay+7)/8),0) or fget(mget((ax+7)/8,(ay+7)/8),0)) return true
	return false	
end

function walcol(a,d)
	local ax=a.x
	local ay=a.y
	
	if (d=="l" and (fget(mget((ax-1)/8,ay/8),0) or fget(mget((ax-1)/8,(ay-7)/8),0))) return true
	if (d=="r" and (fget(mget((ax+8)/8,ay/8),0) or fget(mget((ax+8)/8,(ay-7)/8),0))) return true
	return false
end
__gfx__
00000000bbb0000b0000000033333333033333333333333000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000bb0aaa0b3333333333333333033333333333333000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700b0a0aa003333333333333333033333333333333000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000b0aa99903333333333333333033333333333333000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000b0aaaa0b3333333333333333033333333333333000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700b0aaaa0b3333333333333333033333333333333000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000b040040b3333333333333333033333333333333000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000b040040b3333333333333333033333333333333000000000000000000000000000000000000000000000000000000000000000000000000000000000
__gff__
0000010101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000040303050000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0202020202020202020202020202020200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0303030303030303030303030303030300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
